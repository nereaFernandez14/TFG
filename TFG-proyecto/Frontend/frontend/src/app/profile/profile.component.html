<div class="perfil-wrapper">

  <!-- üîî TOASTS DE NOTIFICACIONES -->
  <div class="toast-container" *ngIf="notificaciones?.length">
    <div class="toast" *ngFor="let n of notificaciones">
      <span>{{ n.mensaje }}</span>
      <button (click)="cerrarNotificacion(n.id)">‚úñ</button>
    </div>
  </div>

  <section class="perfil-contenido">
    <div class="perfil-container">

      <!-- üë§ Info del Usuario -->
      <div class="perfil-card">
        <div class="perfil-header">
          <i class="fas fa-user-circle perfil-icon"></i>
          <h2>{{ usuario?.nombre }} {{ usuario?.apellidos }}</h2>
        </div>

        <div class="perfil-info">
          <p><strong>Email:</strong> {{ usuario?.email }}</p>
          <p><strong>Rol:</strong>
            {{
              usuario?.rol === 'ADMIN' ? 'Administrador' :
              usuario?.rol === 'USUARIO' ? 'Usuario' :
              usuario?.rol === 'RESTAURANTE' ? 'Restaurante' :
              usuario?.rol
            }}
          </p>
        </div>
      </div>

      <!-- üîî Notificaciones (opcional: duplicado visual del toast si quieres mantener) -->
      <div *ngIf="notificaciones && notificaciones.length > 0" class="notificaciones-section">
        <h3><i class="fas fa-bell"></i> Notificaciones</h3>
        <ul class="notificaciones-list">
          <li *ngFor="let noti of notificaciones" class="notificacion-item">
            {{ noti.mensaje }}
            <button class="cerrar-btn" (click)="cerrarNotificacion(noti.id)">
              <i class="fas fa-times"></i>
            </button>
          </li>
        </ul>
      </div>

      <!-- ‚úÖ Preferencias diet√©ticas para usuario -->
      <div *ngIf="usuario?.rol === 'USUARIO'" class="extra-section">
        <h3><i class="fas fa-carrot"></i> Preferencias diet√©ticas</h3>
        <form>
          <div *ngFor="let restriccion of restriccionesEnum" class="checkbox-linea">
            <label>
              <input
                type="checkbox"
                [value]="restriccion"
                [checked]="restriccionesSeleccionadas.includes(restriccion)"
                (change)="toggleRestriccion(restriccion)" />
              {{ formatearRestriccion(restriccion) }}
            </label>
          </div>
          <br />
          <button type="button" (click)="guardarPreferencias()">Guardar preferencias</button>
        </form>
      </div>

      <!-- ‚úÖ Botones de acci√≥n -->
      <div class="perfil-actions">
        <button type="button" (click)="irACambiarPassword()">Cambiar contrase√±a</button>
        <button
          *ngIf="usuario?.rol === 'USUARIO' || usuario?.rol === 'RESTAURANTE'"
          class="baja-btn"
          (click)="solicitarBaja()">
          <i class="fas fa-user-slash"></i> Solicitar baja de {{ usuario?.rol?.toLowerCase() }}
        </button>
        <button
          *ngIf="usuario?.rol === 'USUARIO' || usuario?.rol === 'RESTAURANTE'"
          class="modificar-btn"
          (click)="abrirVentanaModificacionUsuario()">
          <i class="fas fa-edit"></i> Solicitar modificaci√≥n de mis datos
        </button>
      </div>

      <!-- üåê Modal de modificaci√≥n de usuario -->
      <div class="modal" *ngIf="mostrarVentanaModificacionUsuario">
        <div class="modal-content">
          <h3><i class="fas fa-user-edit"></i> Solicitar modificaci√≥n de usuario</h3>

          <div class="form-group">
            <label>Campo a modificar:</label>
            <select [(ngModel)]="campoSeleccionadoUsuario">
              <option value="" disabled selected>-- Selecciona un campo --</option>
              <option value="nombre">Nombre</option>
              <option value="apellidos">Apellidos</option>
              <option value="email">Email</option>
            </select>
          </div>

          <div class="form-group" *ngIf="campoSeleccionadoUsuario">
            <label>Nuevo valor:</label>
            <input type="text" [(ngModel)]="nuevoValorUsuario" placeholder="Introduce el nuevo valor" />
          </div>

          <div class="modal-actions">
            <button class="btn primary" [disabled]="botonUsuarioDeshabilitado" (click)="enviarModificacionUsuario()">
              <i class="fas fa-paper-plane"></i> Enviar
            </button>
            <button class="btn secondary" (click)="cerrarVentanaModificacionUsuario()">
              <i class="fas fa-times"></i> Cancelar
            </button>
          </div>
        </div>
      </div>

    </div>
  </section>
</div>
