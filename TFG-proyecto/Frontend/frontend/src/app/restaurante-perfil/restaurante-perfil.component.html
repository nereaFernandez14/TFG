<div *ngIf="restaurante" class="perfil-restaurante">
  <!-- üè™ Cabecera -->
  <div class="header-restaurante">
    <h2 class="nombre-restaurante">
      <i class="fas fa-store"></i> {{ restaurante.nombre }}
    </h2>

    <!-- ‚ù§Ô∏è Bot√≥n de favorito -->
    <button *ngIf="esUsuario" (click)="toggleFavorito()" class="btn-favorito">
      <i class="fas" [class.fa-heart]="esFavorito" [class.fa-heart-broken]="!esFavorito"></i>
      <span>{{ esFavorito ? 'Quitar de favoritos' : 'A√±adir a favoritos' }}</span>
    </button>
  </div>

  <!-- üìù Descripci√≥n -->
  <p class="descripcion-restaurante">
    <i class="fas fa-info-circle"></i>
    {{ restaurante.descripcion || 'Sin descripci√≥n disponible' }}
  </p>

  <!-- ‚òéÔ∏è Contacto -->
  <div class="info-contacto">
    <p><i class="fas fa-map-marker-alt"></i> {{ restaurante.direccion }}</p>
    <p><i class="fas fa-phone-alt"></i> {{ restaurante.telefono }}</p>
  </div>

  <!-- üè∑Ô∏è Etiquetas -->
  <div class="etiquetas">
    <span class="etiqueta"><i class="fas fa-utensils"></i> {{ restaurante.tipoCocina }}</span>
    <span class="etiqueta"><i class="fas fa-city"></i> {{ restaurante.barrio }}</span>
    <span class="etiqueta"><i class="fas fa-euro-sign"></i> {{ restaurante.rangoPrecio }}</span>
    <span *ngFor="let restriccion of restaurante.restriccionesDieteticas" class="etiqueta">
      <i class="fas fa-leaf"></i> {{ restriccion }}
    </span>
  </div>

  <!-- üéûÔ∏è Carrusel -->
  <div *ngIf="restaurante.imagenes?.length" class="carrusel">
    <button class="nav-btn" (click)="anteriorImagen()" title="Anterior">
      <i class="fas fa-chevron-left"></i>
    </button>

    <div class="carrusel-imagen">
      <img
        *ngIf="restaurante.imagenes?.length"
        [src]="'https://localhost:8443/uploads/restaurantes/' + restaurante.id + '/' + restaurante.imagenes[imagenActual]"
        alt="Imagen del restaurante"
        class="img-carrusel fade-in"
      />
    </div>

    <button class="nav-btn" (click)="siguienteImagen()" title="Siguiente">
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <!-- üìã Men√∫ -->
  <div *ngIf="restaurante.rutaMenu" class="menu-restaurante">
    <h3><i class="fas fa-clipboard-list"></i> Men√∫ del restaurante</h3>
    <a
      [href]="'https://localhost:8443/restaurantes/menus/' + obtenerNombreArchivo(restaurante.rutaMenu)"
      target="_blank"
      class="boton-descargar"
      download
    >
      <i class="fas fa-file-download"></i> Descargar men√∫
    </a>
  </div>

  <!-- ‚úçÔ∏è A√±adir/Modificar rese√±a -->
  <ng-container *ngIf="mostrarFormularioResena; else mensajeLogin">
    <button class="btn-resena" (click)="abrirModalResena()">
      <i class="fas fa-pen"></i>
      {{ yaTieneResena ? 'Modificar rese√±a' : 'A√±adir rese√±a' }}
    </button>
  </ng-container>

  <!-- üîí Requiere login -->
  <ng-template #mensajeLogin>
    <p class="aviso-login">
      <i class="fas fa-lock"></i> Debes iniciar sesi√≥n para dejar una rese√±a.
    </p>
  </ng-template>

  <!-- üí¨ Modal de Rese√±a -->
  <div class="modal-backdrop" *ngIf="modalAbierto" (click)="cerrarModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <app-resenya
        [restauranteNombre]="restaurante.nombre"
        [restauranteId]="restaurante.id"
        [resenaExistente]="resenaDelUsuario"
        (resenaEnviada)="recargarResenas(); cerrarModal()"
      ></app-resenya>

      <button class="cerrar-modal" (click)="cerrarModal()"><i class="fas fa-times"></i></button>
    </div>
  </div>

  <!-- üåü Rese√±as -->
  <div class="resenas">
    <h3><i class="fas fa-comments"></i> Rese√±as</h3>

    <div *ngIf="resenas.length === 0" class="sin-rese√±as">
      <i class="fas fa-comment-slash"></i> No hay rese√±as a√∫n.
    </div>

    <div *ngFor="let resena of resenas" class="resena-card">
      <div class="estrellas">
        <ng-container *ngFor="let i of [1,2,3,4,5]">
          <span [class.activa]="i <= resena.valoracion"><i class="fas fa-star"></i></span>
        </ng-container>
      </div>

      <p *ngIf="resena.contenido"><em><i class="fas fa-quote-left"></i> {{ resena.contenido }}</em></p>

      <div *ngIf="resena.imagenes?.length > 0" class="imagenes-resena">
        <div class="img-wrapper" *ngFor="let img of resena.imagenes">
          <img [src]="'/api/imagenes/' + img.id" [alt]="img.nombreArchivo" class="img-resena" />
        </div>
      </div>

      <div class="acciones-resena" *ngIf="esAutorDeResena(resena.autorEmail)">
        <button class="btn btn-danger" (click)="borrarResena(resena.id)">
          <i class="fas fa-trash-alt"></i> Eliminar rese√±a
        </button>
      </div>
    </div>
  </div>
  <!-- ‚úÖ Toast de mensaje de favoritos -->
  <div class="toast-favorito" *ngIf="mensajeFavorito">
    <i class="fas fa-check-circle"></i>
    {{ mensajeFavorito }}
  </div>

</div>
